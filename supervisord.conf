[supervisord]
nodaemon=true
user=root

[program:sshd]
# -D forces sshd to run in the foreground so supervisor can track it
command=/usr/sbin/sshd -D
autostart=true
autorestart=true

[program:vnc]
# We must use /usr/bin/vncserver and provide the full path to the executable
# -fg keeps it in the foreground
command=su - fritz -c "/usr/bin/vncserver :0 -fg -geometry %(ENV_RESOLUTION)s -depth 24 -SecurityTypes None -localhost no"
autostart=true
autorestart=true

[program:novnc]
# Use 127.0.0.1 to avoid Docker IPv6 localhost resolution bugs
command=su - fritz -c "websockify --web=/usr/share/novnc/ 6080 127.0.0.1:5900"
autostart=true
autorestart=true

[program:pulseaudio]
# -n disables reading the default script, --daemonize=no forces foreground
# --exit-idle-time=-1 prevents it from sleeping and exiting with status 0
command=su - fritz -c "pulseaudio -n --daemonize=no --exit-idle-time=-1 --load=module-always-sink --load=module-native-protocol-tcp"
autostart=true
autorestart=true

[program:audio-bridge]
# Wait 3 seconds for pulseaudio to start before trying to bridge it
command=bash -c "sleep 3 && su - fritz -c 'audio-share-server'"
autostart=true
autorestart=true
